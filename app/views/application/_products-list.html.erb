<%
  products ||= nil
%>

<%
=begin%>
  // TODO: Test if each alternatives have images (maybe a rake script)
<%
=end%>

<% products.each do |product| %>
  <% alternative = product.alternatives.first %>
    <div class="col-sm-6 col-md-4 col-lg-3 mb-3 product-card" data-filter="<%= product.category.id %>">
      <%= link_to product_path(product) do %>
        <% if alternative.respond_to?(:image) && alternative.image.respond_to?(:key) %>
          <%= cl_image_tag  alternative.image.key,
                            quality: "auto", 
                            fetch_format: :auto, 
                            crop: "scale", 
                            class: "img-fluid rounded", 
                            alt: "Image correspondant à l'alternative #{alternative}" %>
        <% end %>
        <div class="ml-1 row icon">
          <% arrayOfFilter = []
          for i in (0...product.alternatives.count)
            if(arrayOfFilter.exclude?product.alternatives[i].alternative_type_filter.to_s)
                arrayOfFilter.push(product.alternatives[i].alternative_type_filter.to_s)
            end
          end
          arrayOfFilter = arrayOfFilter.sort
          for i in(0..arrayOfFilter.length) %>
            <% if arrayOfFilter[i] == 'En ligne' %>
              <span>🛒</span>
            <% end %>
            <% if arrayOfFilter[i] == 'DIY' %>
              <span>✂️</span>
            <% end %>
          <% end %>
        </div>
        <div class="description">
          <h4><%= product.title %></h4>
          <p><%= product.alternatives.count %> alternative<%= 's' if product.alternatives.count > 1%> trouvée<%= 's' if product.alternatives.count > 1%> 🌱</p>
        </div>
      </div>
  <% end %> 

<% end %> 

